{"componentChunkName":"component---src-templates-blog-post-js","path":"/blogs/color-transfer-lab/","result":{"data":{"site":{"siteMetadata":{"title":"Twistronics Blog"}},"markdownRemark":{"id":"2a1d4943-ef91-5fa8-b07a-f7a5d40365d6","excerpt":"Color Transfer 是基于一阶统计特性的颜色迁移，可以将参考图像的颜色传输到目标图像。 只利用opencv的图片读取和写入操作 首先将图片从rgb转换到Lαβ色彩空间 对输入图像做以下变换 结果示例，输入1.jpg\n\n和2.jpg\n\n输入结果图片为","html":"<p>Color Transfer 是基于一阶统计特性的颜色迁移，可以将参考图像的颜色传输到目标图像。</p>\n<p>只利用opencv的图片读取和写入操作</p>\n<p>首先将图片从rgb转换到Lαβ色彩空间</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">rgb2lab</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">f</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> t <span class=\"token operator\">**</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1.0</span><span class=\"token operator\">/</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">if</span> t <span class=\"token operator\">></span> <span class=\"token number\">0.008856</span> <span class=\"token keyword\">else</span> <span class=\"token number\">7.787</span> <span class=\"token operator\">*</span> t <span class=\"token operator\">+</span> <span class=\"token number\">16.0</span> <span class=\"token operator\">/</span> <span class=\"token number\">116.0</span>\n\n    ref_X <span class=\"token operator\">=</span>  <span class=\"token number\">95.047</span>\n    ref_Y <span class=\"token operator\">=</span> <span class=\"token number\">100.000</span>\n    ref_Z <span class=\"token operator\">=</span> <span class=\"token number\">108.883</span>\n\n    <span class=\"token keyword\">print</span> <span class=\"token string\">'start rgb2lab'</span>\n\n    res <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>zeros<span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">(</span>B<span class=\"token punctuation\">,</span> G<span class=\"token punctuation\">,</span> R<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> img<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">]</span>\n\n            var_R <span class=\"token operator\">=</span> R <span class=\"token operator\">/</span> <span class=\"token number\">255.0</span>\n\n            var_G <span class=\"token operator\">=</span> G <span class=\"token operator\">/</span> <span class=\"token number\">255.0</span>\n            var_B <span class=\"token operator\">=</span> B <span class=\"token operator\">/</span> <span class=\"token number\">255.0</span>\n\n            <span class=\"token keyword\">if</span> var_R <span class=\"token operator\">></span> <span class=\"token number\">0.04045</span><span class=\"token punctuation\">:</span>\n                var_R <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span> var_R <span class=\"token operator\">+</span> <span class=\"token number\">0.055</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">1.055</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">**</span> <span class=\"token number\">2.4</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                var_R <span class=\"token operator\">=</span> var_R <span class=\"token operator\">/</span> <span class=\"token number\">12.92</span>\n\n            <span class=\"token keyword\">if</span> var_G <span class=\"token operator\">></span> <span class=\"token number\">0.04045</span><span class=\"token punctuation\">:</span>\n                var_G <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span> var_G <span class=\"token operator\">+</span> <span class=\"token number\">0.055</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">1.055</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">**</span> <span class=\"token number\">2.4</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                var_G <span class=\"token operator\">=</span> var_G <span class=\"token operator\">/</span> <span class=\"token number\">12.92</span>\n\n            <span class=\"token keyword\">if</span> var_B <span class=\"token operator\">></span> <span class=\"token number\">0.04045</span><span class=\"token punctuation\">:</span>\n                var_B <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span> var_B <span class=\"token operator\">+</span> <span class=\"token number\">0.055</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">1.055</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">**</span> <span class=\"token number\">2.4</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                var_B <span class=\"token operator\">=</span> var_B <span class=\"token operator\">/</span> <span class=\"token number\">12.92</span>\n\n            var_R <span class=\"token operator\">=</span> var_R <span class=\"token operator\">*</span> <span class=\"token number\">100</span>\n            var_G <span class=\"token operator\">=</span> var_G <span class=\"token operator\">*</span> <span class=\"token number\">100</span>\n            var_B <span class=\"token operator\">=</span> var_B <span class=\"token operator\">*</span> <span class=\"token number\">100</span>\n\n            X <span class=\"token operator\">=</span> var_R <span class=\"token operator\">*</span> <span class=\"token number\">0.4124</span> <span class=\"token operator\">+</span> var_G <span class=\"token operator\">*</span> <span class=\"token number\">0.3576</span> <span class=\"token operator\">+</span> var_B <span class=\"token operator\">*</span> <span class=\"token number\">0.1805</span>\n            Y <span class=\"token operator\">=</span> var_R <span class=\"token operator\">*</span> <span class=\"token number\">0.2126</span> <span class=\"token operator\">+</span> var_G <span class=\"token operator\">*</span> <span class=\"token number\">0.7152</span> <span class=\"token operator\">+</span> var_B <span class=\"token operator\">*</span> <span class=\"token number\">0.0722</span>\n            Z <span class=\"token operator\">=</span> var_R <span class=\"token operator\">*</span> <span class=\"token number\">0.0193</span> <span class=\"token operator\">+</span> var_G <span class=\"token operator\">*</span> <span class=\"token number\">0.1192</span> <span class=\"token operator\">+</span> var_B <span class=\"token operator\">*</span> <span class=\"token number\">0.9505</span>\n\n            var_X <span class=\"token operator\">=</span> X <span class=\"token operator\">/</span> ref_X\n            var_Y <span class=\"token operator\">=</span> Y <span class=\"token operator\">/</span> ref_Y\n            var_Z <span class=\"token operator\">=</span> Z <span class=\"token operator\">/</span> ref_Z\n\n            <span class=\"token keyword\">if</span> var_X <span class=\"token operator\">></span> <span class=\"token number\">0.008856</span><span class=\"token punctuation\">:</span>\n                var_X <span class=\"token operator\">=</span> var_X <span class=\"token operator\">**</span> <span class=\"token punctuation\">(</span> <span class=\"token number\">1</span><span class=\"token operator\">/</span><span class=\"token number\">3.0</span> <span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                var_X <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span> <span class=\"token number\">7.787</span> <span class=\"token operator\">*</span> var_X <span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span> <span class=\"token number\">16</span> <span class=\"token operator\">/</span> <span class=\"token number\">116.0</span> <span class=\"token punctuation\">)</span>\n\n            <span class=\"token keyword\">if</span> var_Y <span class=\"token operator\">></span> <span class=\"token number\">0.008856</span><span class=\"token punctuation\">:</span>\n                var_Y <span class=\"token operator\">=</span> var_Y <span class=\"token operator\">**</span> <span class=\"token punctuation\">(</span> <span class=\"token number\">1</span><span class=\"token operator\">/</span><span class=\"token number\">3.0</span> <span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                var_Y <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span> <span class=\"token number\">7.787</span> <span class=\"token operator\">*</span> var_Y <span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span> <span class=\"token number\">16</span> <span class=\"token operator\">/</span> <span class=\"token number\">116.0</span> <span class=\"token punctuation\">)</span>\n\n            <span class=\"token keyword\">if</span> var_Z <span class=\"token operator\">></span> <span class=\"token number\">0.008856</span><span class=\"token punctuation\">:</span>\n                var_Z <span class=\"token operator\">=</span> var_Z <span class=\"token operator\">**</span> <span class=\"token punctuation\">(</span> <span class=\"token number\">1</span><span class=\"token operator\">/</span><span class=\"token number\">3.0</span> <span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                var_Z <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span> <span class=\"token number\">7.787</span> <span class=\"token operator\">*</span> var_Z <span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span> <span class=\"token number\">16</span> <span class=\"token operator\">/</span> <span class=\"token number\">116.0</span> <span class=\"token punctuation\">)</span>\n\n            L <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span> <span class=\"token number\">116</span> <span class=\"token operator\">*</span> var_Y <span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">16</span>\n            a <span class=\"token operator\">=</span> <span class=\"token number\">500</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span> var_X <span class=\"token operator\">-</span> var_Y <span class=\"token punctuation\">)</span>\n            b <span class=\"token operator\">=</span> <span class=\"token number\">200</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span> var_Y <span class=\"token operator\">-</span> var_Z <span class=\"token punctuation\">)</span>\n\n            L <span class=\"token operator\">=</span> <span class=\"token number\">255</span> <span class=\"token operator\">*</span> L <span class=\"token operator\">/</span> <span class=\"token number\">100.0</span>\n            a <span class=\"token operator\">=</span> <span class=\"token number\">128</span> <span class=\"token operator\">+</span> a\n            b <span class=\"token operator\">=</span> <span class=\"token number\">128</span> <span class=\"token operator\">+</span> b\n\n            res<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>L<span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> res\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">lab2rgb</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    res <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>zeros<span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">,</span> dtype<span class=\"token operator\">=</span>np<span class=\"token punctuation\">.</span>uint8<span class=\"token punctuation\">)</span>\n    img <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>astype<span class=\"token punctuation\">(</span><span class=\"token string\">'uint8'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">print</span> <span class=\"token string\">'lab2rgb start'</span>\n\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">(</span>L<span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> img<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">]</span>\n\n            L <span class=\"token operator\">=</span> <span class=\"token number\">100.0</span> <span class=\"token operator\">*</span> L <span class=\"token operator\">/</span> <span class=\"token number\">255.0</span>\n            a <span class=\"token operator\">=</span> a <span class=\"token operator\">-</span> <span class=\"token number\">128</span>\n            b <span class=\"token operator\">=</span> b <span class=\"token operator\">-</span> <span class=\"token number\">128</span>\n\n            var_Y <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span> L <span class=\"token operator\">+</span> <span class=\"token number\">16</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">116.0</span>\n            var_X <span class=\"token operator\">=</span> a <span class=\"token operator\">/</span> <span class=\"token number\">500.0</span> <span class=\"token operator\">+</span> var_Y\n            var_Z <span class=\"token operator\">=</span> var_Y <span class=\"token operator\">-</span> b <span class=\"token operator\">/</span> <span class=\"token number\">200.0</span>\n\n            <span class=\"token keyword\">if</span> var_Y <span class=\"token operator\">**</span> <span class=\"token number\">3</span> <span class=\"token operator\">></span> <span class=\"token number\">0.008856</span><span class=\"token punctuation\">:</span>\n                var_Y <span class=\"token operator\">=</span> var_Y <span class=\"token operator\">**</span> <span class=\"token number\">3</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                var_Y <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span> var_Y <span class=\"token operator\">-</span> <span class=\"token number\">16.0</span> <span class=\"token operator\">/</span> <span class=\"token number\">116.0</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">7.787</span>\n\n            <span class=\"token keyword\">if</span> var_X <span class=\"token operator\">**</span> <span class=\"token number\">3</span> <span class=\"token operator\">></span> <span class=\"token number\">0.008856</span><span class=\"token punctuation\">:</span>\n                var_X <span class=\"token operator\">=</span> var_X <span class=\"token operator\">**</span> <span class=\"token number\">3</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                var_X <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span> var_X <span class=\"token operator\">-</span> <span class=\"token number\">16.0</span> <span class=\"token operator\">/</span> <span class=\"token number\">116.0</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">7.787</span>\n\n            <span class=\"token keyword\">if</span> var_Z <span class=\"token operator\">**</span> <span class=\"token number\">3</span> <span class=\"token operator\">></span> <span class=\"token number\">0.008856</span><span class=\"token punctuation\">:</span>\n                var_Z <span class=\"token operator\">=</span> var_Z <span class=\"token operator\">**</span> <span class=\"token number\">3</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                var_Z <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span> var_Z <span class=\"token operator\">-</span> <span class=\"token number\">16.0</span> <span class=\"token operator\">/</span> <span class=\"token number\">116.0</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">7.787</span>\n\n            var_R <span class=\"token operator\">=</span> var_X <span class=\"token operator\">*</span>  <span class=\"token number\">3.2406</span> <span class=\"token operator\">+</span> var_Y <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1.5372</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> var_Z <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">0.4986</span><span class=\"token punctuation\">)</span>\n            var_G <span class=\"token operator\">=</span> var_X <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">0.9689</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> var_Y <span class=\"token operator\">*</span>  <span class=\"token number\">1.8758</span> <span class=\"token operator\">+</span> var_Z <span class=\"token operator\">*</span>  <span class=\"token number\">0.0415</span>\n            var_B <span class=\"token operator\">=</span> var_X <span class=\"token operator\">*</span>  <span class=\"token number\">0.0557</span> <span class=\"token operator\">+</span> var_Y <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">0.2040</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> var_Z <span class=\"token operator\">*</span>  <span class=\"token number\">1.0570</span>\n\n            <span class=\"token keyword\">if</span> var_R <span class=\"token operator\">></span> <span class=\"token number\">0.0031308</span><span class=\"token punctuation\">:</span>\n                var_R <span class=\"token operator\">=</span> <span class=\"token number\">1.055</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span> var_R <span class=\"token operator\">**</span> <span class=\"token punctuation\">(</span> <span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token number\">2.4</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">0.055</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                var_R <span class=\"token operator\">=</span> <span class=\"token number\">12.92</span> <span class=\"token operator\">*</span> var_R\n\n            <span class=\"token keyword\">if</span> var_G <span class=\"token operator\">></span> <span class=\"token number\">0.0031308</span><span class=\"token punctuation\">:</span>\n                var_G <span class=\"token operator\">=</span> <span class=\"token number\">1.055</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span> var_G <span class=\"token operator\">**</span> <span class=\"token punctuation\">(</span> <span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token number\">2.4</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">0.055</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                var_G <span class=\"token operator\">=</span> <span class=\"token number\">12.92</span> <span class=\"token operator\">*</span> var_G\n\n            <span class=\"token keyword\">if</span> var_B <span class=\"token operator\">></span> <span class=\"token number\">0.0031308</span><span class=\"token punctuation\">:</span>\n                var_B <span class=\"token operator\">=</span> <span class=\"token number\">1.055</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span> var_B <span class=\"token operator\">**</span> <span class=\"token punctuation\">(</span> <span class=\"token number\">1</span> <span class=\"token operator\">/</span> <span class=\"token number\">2.4</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">0.055</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                var_B <span class=\"token operator\">=</span> <span class=\"token number\">12.92</span> <span class=\"token operator\">*</span> var_B\n\n            R <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>uint8<span class=\"token punctuation\">(</span><span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span>var_R <span class=\"token operator\">*</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            G <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>uint8<span class=\"token punctuation\">(</span><span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span>var_G <span class=\"token operator\">*</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            B <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>uint8<span class=\"token punctuation\">(</span><span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span>var_B <span class=\"token operator\">*</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">print</span> <span class=\"token string\">'end'</span>\n\n    <span class=\"token keyword\">return</span> res</code></pre></div>\n<p>对输入图像做以下变换</p>\n<img src=\"http://chart.googleapis.com/chart?cht=tx&amp;chl=l(p)\\leftarrow%20\\frac{\\sigma%20_{b}}{\\sigma%20_{a}}(l(p)-\\mu%20_{A})+\\mu%20_{b}\" style=\"border:none;\">\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">lab_stats</span><span class=\"token punctuation\">(</span>img_lab<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token punctuation\">(</span>l<span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> split<span class=\"token punctuation\">(</span>img_lab<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'l'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">'mean'</span><span class=\"token punctuation\">:</span> np<span class=\"token punctuation\">.</span>mean<span class=\"token punctuation\">(</span>l<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'sigma'</span><span class=\"token punctuation\">:</span> np<span class=\"token punctuation\">.</span>std<span class=\"token punctuation\">(</span>l<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'a'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">'mean'</span><span class=\"token punctuation\">:</span> np<span class=\"token punctuation\">.</span>mean<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'sigma'</span><span class=\"token punctuation\">:</span> np<span class=\"token punctuation\">.</span>std<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'b'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">'mean'</span><span class=\"token punctuation\">:</span> np<span class=\"token punctuation\">.</span>mean<span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'sigma'</span><span class=\"token punctuation\">:</span> np<span class=\"token punctuation\">.</span>std<span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\nsrc_lab <span class=\"token operator\">=</span> rgb2lab<span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">)</span>\ntag_lab <span class=\"token operator\">=</span> rgb2lab<span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">)</span>\n\nsrc_stats <span class=\"token operator\">=</span> lab_stats<span class=\"token punctuation\">(</span>src_lab<span class=\"token punctuation\">)</span>\ntag_stats <span class=\"token operator\">=</span> lab_stats<span class=\"token punctuation\">(</span>tag_lab<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token punctuation\">(</span>l<span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> split<span class=\"token punctuation\">(</span>tag_lab<span class=\"token punctuation\">)</span>\n\nl <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>l <span class=\"token operator\">-</span> tag_stats<span class=\"token punctuation\">[</span><span class=\"token string\">'l'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'mean'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> \\\n    <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>tag_stats<span class=\"token punctuation\">[</span><span class=\"token string\">'l'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'sigma'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">/</span> src_stats<span class=\"token punctuation\">[</span><span class=\"token string\">'l'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'sigma'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> \\\n    <span class=\"token operator\">+</span>  src_stats<span class=\"token punctuation\">[</span><span class=\"token string\">'l'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'mean'</span><span class=\"token punctuation\">]</span>\n\na <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>a <span class=\"token operator\">-</span> tag_stats<span class=\"token punctuation\">[</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'mean'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> \\\n    <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>tag_stats<span class=\"token punctuation\">[</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'sigma'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">/</span> src_stats<span class=\"token punctuation\">[</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'sigma'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> \\\n    <span class=\"token operator\">+</span>  src_stats<span class=\"token punctuation\">[</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'mean'</span><span class=\"token punctuation\">]</span>\n\nb <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>b <span class=\"token operator\">-</span> tag_stats<span class=\"token punctuation\">[</span><span class=\"token string\">'b'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'mean'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> \\\n    <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>tag_stats<span class=\"token punctuation\">[</span><span class=\"token string\">'b'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'sigma'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">/</span> src_stats<span class=\"token punctuation\">[</span><span class=\"token string\">'b'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'sigma'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> \\\n    <span class=\"token operator\">+</span>  src_stats<span class=\"token punctuation\">[</span><span class=\"token string\">'b'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'mean'</span><span class=\"token punctuation\">]</span>\n\n\nl <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>clip<span class=\"token punctuation\">(</span>l<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span>\na <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>clip<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span>\nb <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>clip<span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span>\n\n\n\nres_lab <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>zeros<span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">for</span> k <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            res_lab<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>l<span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">]</span>\n\nres <span class=\"token operator\">=</span> lab2rgb<span class=\"token punctuation\">(</span>res_lab<span class=\"token punctuation\">)</span></code></pre></div>\n<p>结果示例，输入1.jpg\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ef262e9a68adc8f86ae61e21cf3a8176/ac99c/1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.21621621621621%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIDBAX/xAAWAQEBAQAAAAAAAAAAAAAAAAACAAH/2gAMAwEAAhADEAAAAb8tFBzlC3//xAAaEAACAwEBAAAAAAAAAAAAAAAAAQIDEhAR/9oACAEBAAEFApOqStaYzbNe8//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABcRAQADAAAAAAAAAAAAAAAAAAABERL/2gAIAQIBAT8B3K3/xAAaEAABBQEAAAAAAAAAAAAAAAABABESICKR/9oACAEBAAY/Apa4mANf/8QAGxAAAwACAwAAAAAAAAAAAAAAAAERIXExscH/2gAIAQEAAT8hkS0Rw77EjnhLjsbhs//aAAwDAQACAAMAAAAQgy//xAAWEQADAAAAAAAAAAAAAAAAAAABEBH/2gAIAQMBAT8QgX//xAAXEQADAQAAAAAAAAAAAAAAAAAAAREh/9oACAECAQE/EG3Cz//EABwQAQEAAQUBAAAAAAAAAAAAAAERACExUWGRcf/aAAgBAQABPxBy3WU174xgGjVOvhmthpxgBuPmNy9txVbFz//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/ef262e9a68adc8f86ae61e21cf3a8176/1c72d/1.jpg\"\n        srcset=\"/static/ef262e9a68adc8f86ae61e21cf3a8176/a80bd/1.jpg 148w,\n/static/ef262e9a68adc8f86ae61e21cf3a8176/1c91a/1.jpg 295w,\n/static/ef262e9a68adc8f86ae61e21cf3a8176/1c72d/1.jpg 590w,\n/static/ef262e9a68adc8f86ae61e21cf3a8176/a8a14/1.jpg 885w,\n/static/ef262e9a68adc8f86ae61e21cf3a8176/fbd2c/1.jpg 1180w,\n/static/ef262e9a68adc8f86ae61e21cf3a8176/ac99c/1.jpg 1536w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n和2.jpg\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3e15ab7c11e9225da3b0b9d195fd3072/6a068/2.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.4054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAQFAv/EABQBAQAAAAAAAAAAAAAAAAAAAAP/2gAMAwEAAhADEAAAAVGYlAFTMCn/AP/EABoQAQACAwEAAAAAAAAAAAAAAAIBMgADEzH/2gAIAQEAAQUC081iBgu0e2hW/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAEDAQE/AR2b/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAECEf/aAAgBAgEBPwGlgj//xAAZEAADAAMAAAAAAAAAAAAAAAAAARECEHH/2gAIAQEABj8CK8VO7jGf/8QAGxABAAMBAAMAAAAAAAAAAAAAAQARIUExUaH/2gAIAQEAAT8hAeN9MRVHpHYwdCNpsFvbAn3T/9oADAMBAAIAAwAAABDIL//EABcRAQADAAAAAAAAAAAAAAAAAAABESH/2gAIAQMBAT8QqJa//8QAGBEAAgMAAAAAAAAAAAAAAAAAAAERIWH/2gAIAQIBAT8QlYJSP//EABwQAQACAwADAAAAAAAAAAAAAAEAESExQVFhgf/aAAgBAQABPxDhp2mSE/B5DKrwUA6OQDCEdjLgrwF9x3bxHyf/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2\"\n        title=\"2\"\n        src=\"/static/3e15ab7c11e9225da3b0b9d195fd3072/1c72d/2.jpg\"\n        srcset=\"/static/3e15ab7c11e9225da3b0b9d195fd3072/a80bd/2.jpg 148w,\n/static/3e15ab7c11e9225da3b0b9d195fd3072/1c91a/2.jpg 295w,\n/static/3e15ab7c11e9225da3b0b9d195fd3072/1c72d/2.jpg 590w,\n/static/3e15ab7c11e9225da3b0b9d195fd3072/a8a14/2.jpg 885w,\n/static/3e15ab7c11e9225da3b0b9d195fd3072/6a068/2.jpg 960w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n输入结果图片为\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0338a13dd77d555fc1ac456d615af2a0/6a068/res.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.4054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAACBf/EABUBAQEAAAAAAAAAAAAAAAAAAAIA/9oADAMBAAIQAxAAAAE6eI8Q7Mx//8QAGhABAAIDAQAAAAAAAAAAAAAAAgEyAAMTMf/aAAgBAQABBQLTzWIEl2j20K3/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPwEn/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQIBAT8BSf/EABkQAAIDAQAAAAAAAAAAAAAAAAABAhARcf/aAAgBAQAGPwI1xWdvJDP/xAAbEAEAAgIDAAAAAAAAAAAAAAABACERQTFRof/aAAgBAQABPyEBxfUQYjsjcUNhFSC5zIE9k//aAAwDAQACAAMAAAAQEz//xAAXEQEBAQEAAAAAAAAAAAAAAAABABEx/9oACAEDAQE/EFpPb//EABcRAAMBAAAAAAAAAAAAAAAAAAABETH/2gAIAQIBAT8QmxYf/8QAGxABAAMBAAMAAAAAAAAAAAAAAQARMSFBUWH/2gAIAQEAAT8Qp3J1PYR8HsMQoKoBwcjDCiOjUsUvAX7Fd/hE/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"res\"\n        title=\"res\"\n        src=\"/static/0338a13dd77d555fc1ac456d615af2a0/1c72d/res.jpg\"\n        srcset=\"/static/0338a13dd77d555fc1ac456d615af2a0/a80bd/res.jpg 148w,\n/static/0338a13dd77d555fc1ac456d615af2a0/1c91a/res.jpg 295w,\n/static/0338a13dd77d555fc1ac456d615af2a0/1c72d/res.jpg 590w,\n/static/0338a13dd77d555fc1ac456d615af2a0/a8a14/res.jpg 885w,\n/static/0338a13dd77d555fc1ac456d615af2a0/6a068/res.jpg 960w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>","frontmatter":{"title":"Color Transfer 实验","date":"April 07, 2016","description":"Color Transfer 是基于一阶统计特性的颜色迁移，可以将参考图像的颜色传输到目标图像。","tags":["Python","Digital image processing","Algorithm"]}}},"pageContext":{"slug":"/blogs/color-transfer-lab/","previous":{"fields":{"slug":"/blogs/HSQLDB-code-analysis-5/"},"frontmatter":{"title":"HSQLDB (5)：并发控制机制分析"}},"next":{"fields":{"slug":"/blogs/Region-Filling-and-Object-Removal-by-Exemplar-Based-Image-Inpainting/"},"frontmatter":{"title":"Region Filling and Object Removal by Exemplar-Based Image Inpainting"}}}}}