{"componentChunkName":"component---src-templates-blog-post-js","path":"/blogs/Sliding-Window-Protocol/","result":{"data":{"site":{"siteMetadata":{"title":"Twistronics Blog"}},"markdownRemark":{"id":"5bc65517-e46e-5f33-b924-09038b03a850","excerpt":"滑动窗口协议（Sliding Window Protocol）是计算机网络中为保证流控制和可靠传输而常用的一种协议，一般在传输层TCP…","html":"<p>滑动窗口协议（Sliding Window Protocol）是计算机网络中为保证流控制和可靠传输而常用的一种协议，一般在传输层TCP协议中实现，有些情况下也在数据链路层实现。窗口机制是重传、 流控、 拥塞控制的基本方法， 它在发送方和接收方分别设定发送窗口和接收窗口，发送窗口和接收窗口按照某种规律不断的向前滑动， 滑动窗口协议由此得名。</p>\n<ol>\n<li>窗口机制\n滑动窗口协议的基本原理就是在任意时刻，发送方都维持了一个连续的允许发送的帧的序号，称为发送窗口；同时，接收方也维持了一个连续的允许接收的帧的序号，称为接收窗口。发送窗口和接收窗口的序号的上下界不一定要一样，甚至大小也可以不同。不同的滑动窗口协议窗口大小一般不同。发送方窗口内的序列号代表了那些已经被发送，但是还没有被确认的帧，或者是那些可以被发送的帧。</li>\n<li>1比特滑动窗口协议\n当发送窗口和接收窗口的大小固定为1时，滑动窗口协议退化为停等协议（stop-and-wait）。该协议规定发送方每发送一帧后就要停下来，等待接收方已正确接收的确认（acknowledgement）返回后才能继续发送下一帧。由于接收方需要判断接收到的帧是新发的帧还是重新发送的帧，因此发送方要为每一个帧加一个序号。由于停等协议规定只有一帧完全发送成功后才能发送新的帧，因而只用一比特来编号就够了。</li>\n<li>后退n协议\n由于停等协议要为每一个帧进行确认后才继续发送下一帧，大大降低了信道利用率，因此又提出了后退n协议。后退n协议中，发送方在发完一个数据帧后，不停下来等待应答帧，而是连续发送若干个数据帧，即使在连续发送过程中收到了接收方发来的应答帧，也可以继续发送，且发送方在每发送完一个数据帧时都要设置超时定时器，只要在所设置的超时时间内仍收到确认帧，就要重发相应的数据帧。如：当发送方发送了N个帧后，若发现该N帧的前一个帧在计时器超时后仍未返回其确认信息，则该帧被判为出错或丢失，此时发送方就不得不重新发送出错帧及其后的N帧。</li>\n</ol>\n<p><code class=\"language-text\">SlidingWindowDlg.h</code></p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\">#<span class=\"token directive keyword\">pragma</span> once</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"protocol.h\"</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"afxwin.h\"</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"afx.h\"</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"afxcmn.h\"</span></span>\n\n<span class=\"token comment\">// CSlidingWindowDlg对话框</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">CSlidingWindowDlg</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">public</span> CDialog\n<span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// 构造</span>\n<span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n\t<span class=\"token function\">CSlidingWindowDlg</span><span class=\"token punctuation\">(</span>CWnd<span class=\"token operator\">*</span> pParent <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t<span class=\"token comment\">// 标准构造函数</span>\n<span class=\"token comment\">// 对话框数据</span>\n\t<span class=\"token keyword\">enum</span> <span class=\"token punctuation\">{</span> IDD <span class=\"token operator\">=</span> IDD_SLIDINGWINDOW_DIALOG <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">protected</span><span class=\"token operator\">:</span>\n\t<span class=\"token keyword\">virtual</span> <span class=\"token keyword\">void</span> <span class=\"token function\">DoDataExchange</span><span class=\"token punctuation\">(</span>CDataExchange<span class=\"token operator\">*</span> pDX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t<span class=\"token comment\">// DDX/DDV 支持</span>\n\n<span class=\"token comment\">// 实现</span>\n<span class=\"token keyword\">protected</span><span class=\"token operator\">:</span>\n\tHICON m_hIcon<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// 生成的消息映射函数</span>\n\t<span class=\"token keyword\">virtual</span> BOOL <span class=\"token function\">OnInitDialog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tafx_msg <span class=\"token keyword\">void</span> <span class=\"token function\">OnSysCommand</span><span class=\"token punctuation\">(</span>UINT nID<span class=\"token punctuation\">,</span> LPARAM lParam<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tafx_msg <span class=\"token keyword\">void</span> <span class=\"token function\">OnPaint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tafx_msg HCURSOR <span class=\"token function\">OnQueryDragIcon</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">DECLARE_MESSAGE_MAP</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n\tCStringm_szDestination<span class=\"token punctuation\">;</span>\n\tCStringm_szSendFile<span class=\"token punctuation\">;</span>\n\tCStringm_szSavePath<span class=\"token punctuation\">;</span>\n\tafx_msg <span class=\"token keyword\">void</span> <span class=\"token function\">OnBnClickedButtonSavePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tafx_msg <span class=\"token keyword\">void</span> <span class=\"token function\">OnBnClickedButtonSendFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n\tafx_msg <span class=\"token keyword\">void</span> <span class=\"token function\">OnBnClickedButtonListen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">private</span><span class=\"token operator\">:</span>\n\tCProtocolm_myProtocol<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n\tafx_msg <span class=\"token keyword\">void</span> <span class=\"token function\">OnTimer</span><span class=\"token punctuation\">(</span>UINT_PTR nIDEvent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">void</span> <span class=\"token function\">OnReceive</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span> buf <span class=\"token punctuation\">,</span> UINT nBytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">private</span><span class=\"token operator\">:</span>\n\tUINT m_nDestPort<span class=\"token punctuation\">;</span>\n\tCListBoxm_listSend<span class=\"token punctuation\">;</span>\n\tCListBoxm_listReceive<span class=\"token punctuation\">;</span>\n\tUINT m_nLocalPort<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n\tafx_msg <span class=\"token keyword\">void</span> <span class=\"token function\">OnBnClickedButtonSend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">private</span><span class=\"token operator\">:</span>\n\t<span class=\"token keyword\">static</span> UINT <span class=\"token function\">SendThread</span><span class=\"token punctuation\">(</span>LPVOID p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tCFilem_fileSave<span class=\"token punctuation\">;</span>\n\tULONGLONG m_nRecvFileSize<span class=\"token punctuation\">;</span>\n\tULONGLONG m_nRecvNow<span class=\"token punctuation\">;</span>\n\tCProgressCtrlm_proSend<span class=\"token punctuation\">;</span>\n\tCProgressCtrlm_proReceive<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">SlidingWindowDlg.cpp</code></p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"stdafx.h\"</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"SlidingWindow.h\"</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"SlidingWindowDlg.h\"</span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">\"Protocol.h\"</span></span>\n\n<span class=\"token macro property\">#<span class=\"token directive keyword\">ifdef</span> _DEBUG</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">define</span> new DEBUG_NEW</span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">endif</span></span>\n\ntypedefstruct\n<span class=\"token punctuation\">{</span>\n\tCHAR szIdentify<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\tTCHAR szName<span class=\"token punctuation\">[</span>MAX_PATH<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\tULONGLONG nLength<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> HEADE<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 用于应用程序“关于”菜单项的CAboutDlg对话框</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">CAboutDlg</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">public</span> CDialog\n<span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n\t<span class=\"token function\">CAboutDlg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 对话框数据</span>\n\t<span class=\"token keyword\">enum</span> <span class=\"token punctuation\">{</span> IDD <span class=\"token operator\">=</span> IDD_ABOUTBOX <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">protected</span><span class=\"token operator\">:</span>\n\t<span class=\"token keyword\">virtual</span> <span class=\"token keyword\">void</span> <span class=\"token function\">DoDataExchange</span><span class=\"token punctuation\">(</span>CDataExchange<span class=\"token operator\">*</span> pDX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// DDX/DDV 支持</span>\n<span class=\"token comment\">// 实现</span>\n<span class=\"token keyword\">protected</span><span class=\"token operator\">:</span>\n\t<span class=\"token function\">DECLARE_MESSAGE_MAP</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nCAboutDlg<span class=\"token operator\">::</span><span class=\"token function\">CAboutDlg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">CDialog</span><span class=\"token punctuation\">(</span>CAboutDlg<span class=\"token operator\">::</span>IDD<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> CAboutDlg<span class=\"token operator\">::</span><span class=\"token function\">DoDataExchange</span><span class=\"token punctuation\">(</span>CDataExchange<span class=\"token operator\">*</span> pDX<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\tCDialog<span class=\"token operator\">::</span><span class=\"token function\">DoDataExchange</span><span class=\"token punctuation\">(</span>pDX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">BEGIN_MESSAGE_MAP</span><span class=\"token punctuation\">(</span>CAboutDlg<span class=\"token punctuation\">,</span> CDialog<span class=\"token punctuation\">)</span>\n<span class=\"token function\">END_MESSAGE_MAP</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// CSlidingWindowDlg对话框</span>\nCSlidingWindowDlg<span class=\"token operator\">::</span><span class=\"token function\">CSlidingWindowDlg</span><span class=\"token punctuation\">(</span>CWnd<span class=\"token operator\">*</span> pParent <span class=\"token comment\">/*=NULL*/</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token operator\">:</span> <span class=\"token function\">CDialog</span><span class=\"token punctuation\">(</span>CSlidingWindowDlg<span class=\"token operator\">::</span>IDD<span class=\"token punctuation\">,</span> pParent<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">,</span> <span class=\"token function\">m_szDestination</span><span class=\"token punctuation\">(</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">,</span> <span class=\"token function\">m_szSendFile</span><span class=\"token punctuation\">(</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">,</span> <span class=\"token function\">m_szSavePath</span><span class=\"token punctuation\">(</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">,</span> <span class=\"token function\">m_nDestPort</span><span class=\"token punctuation\">(</span><span class=\"token number\">52520</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">,</span> <span class=\"token function\">m_nLocalPort</span><span class=\"token punctuation\">(</span><span class=\"token number\">52520</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">,</span> <span class=\"token function\">m_nRecvFileSize</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">,</span> <span class=\"token function\">m_nRecvNow</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\tm_hIcon <span class=\"token operator\">=</span> <span class=\"token function\">AfxGetApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">LoadIcon</span><span class=\"token punctuation\">(</span>IDR_MAINFRAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> CSlidingWindowDlg<span class=\"token operator\">::</span><span class=\"token function\">DoDataExchange</span><span class=\"token punctuation\">(</span>CDataExchange<span class=\"token operator\">*</span> pDX<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\tCDialog<span class=\"token operator\">::</span><span class=\"token function\">DoDataExchange</span><span class=\"token punctuation\">(</span>pDX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">DDX_Text</span><span class=\"token punctuation\">(</span>pDX<span class=\"token punctuation\">,</span> IDC_DESTINATION<span class=\"token punctuation\">,</span> m_szDestination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">DDX_Text</span><span class=\"token punctuation\">(</span>pDX<span class=\"token punctuation\">,</span> IDC_SEND_FILE<span class=\"token punctuation\">,</span> m_szSendFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">DDX_Text</span><span class=\"token punctuation\">(</span>pDX<span class=\"token punctuation\">,</span> IDC_SAVE_PATH<span class=\"token punctuation\">,</span> m_szSavePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">DDX_Text</span><span class=\"token punctuation\">(</span>pDX<span class=\"token punctuation\">,</span> IDC_DESTINATION_PORT<span class=\"token punctuation\">,</span> m_nDestPort<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">DDV_MinMaxUInt</span><span class=\"token punctuation\">(</span>pDX<span class=\"token punctuation\">,</span> m_nDestPort<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">65535</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">DDX_Control</span><span class=\"token punctuation\">(</span>pDX<span class=\"token punctuation\">,</span> IDC_LIST_SEND<span class=\"token punctuation\">,</span> m_listSend<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">DDX_Control</span><span class=\"token punctuation\">(</span>pDX<span class=\"token punctuation\">,</span> IDC_LIST_RECEIVE<span class=\"token punctuation\">,</span> m_listReceive<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">DDX_Text</span><span class=\"token punctuation\">(</span>pDX<span class=\"token punctuation\">,</span> IDC_OWN_PORT<span class=\"token punctuation\">,</span> m_nLocalPort<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">DDV_MinMaxUInt</span><span class=\"token punctuation\">(</span>pDX<span class=\"token punctuation\">,</span> m_nLocalPort<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">65535</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">DDX_Control</span><span class=\"token punctuation\">(</span>pDX<span class=\"token punctuation\">,</span> IDC_PROGRESS_RECEIVE<span class=\"token punctuation\">,</span> m_proReceive<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">DDX_Control</span><span class=\"token punctuation\">(</span>pDX<span class=\"token punctuation\">,</span> IDC_PROGRESS_SEND<span class=\"token punctuation\">,</span> m_proSend<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">BEGIN_MESSAGE_MAP</span><span class=\"token punctuation\">(</span>CSlidingWindowDlg<span class=\"token punctuation\">,</span> CDialog<span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">ON_WM_SYSCOMMAND</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">ON_WM_PAINT</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">ON_WM_QUERYDRAGICON</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token comment\">//}}AFX_MSG_MAP</span>\n\t<span class=\"token function\">ON_BN_CLICKED</span><span class=\"token punctuation\">(</span>IDC_BUTTON_SAVE_PATH<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>CSlidingWindowDlg<span class=\"token operator\">::</span>OnBnClickedButtonSavePath<span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">ON_BN_CLICKED</span><span class=\"token punctuation\">(</span>IDC_BUTTON_SEND_FILE<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>CSlidingWindowDlg<span class=\"token operator\">::</span>OnBnClickedButtonSendFile<span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">ON_BN_CLICKED</span><span class=\"token punctuation\">(</span>IDC_BUTTON_LISTEN<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>CSlidingWindowDlg<span class=\"token operator\">::</span>OnBnClickedButtonListen<span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">ON_WM_TIMER</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">ON_BN_CLICKED</span><span class=\"token punctuation\">(</span>IDC_BUTTON_SEND<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>CSlidingWindowDlg<span class=\"token operator\">::</span>OnBnClickedButtonSend<span class=\"token punctuation\">)</span>\n<span class=\"token function\">END_MESSAGE_MAP</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// CSlidingWindowDlg消息处理程序</span>\nBOOL CSlidingWindowDlg<span class=\"token operator\">::</span><span class=\"token function\">OnInitDialog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\tCDialog<span class=\"token operator\">::</span><span class=\"token function\">OnInitDialog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token comment\">// 将“关于...”菜单项添加到系统菜单中。</span>\n\t<span class=\"token comment\">// IDM_ABOUTBOX 必须在系统命令范围内。</span>\n\t<span class=\"token function\">ASSERT</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>IDM_ABOUTBOX <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFFF0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> IDM_ABOUTBOX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">ASSERT</span><span class=\"token punctuation\">(</span>IDM_ABOUTBOX <span class=\"token operator\">&lt;</span> <span class=\"token number\">0xF000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tCMenu<span class=\"token operator\">*</span> pSysMenu <span class=\"token operator\">=</span> <span class=\"token function\">GetSystemMenu</span><span class=\"token punctuation\">(</span>FALSE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pSysMenu <span class=\"token operator\">!=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tCStringstrAboutMenu<span class=\"token punctuation\">;</span>\n\t\tstrAboutMenu<span class=\"token punctuation\">.</span><span class=\"token function\">LoadString</span><span class=\"token punctuation\">(</span>IDS_ABOUTBOX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>strAboutMenu<span class=\"token punctuation\">.</span><span class=\"token function\">IsEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\tpSysMenu<span class=\"token operator\">-></span><span class=\"token function\">AppendMenu</span><span class=\"token punctuation\">(</span>MF_SEPARATOR<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\tpSysMenu<span class=\"token operator\">-></span><span class=\"token function\">AppendMenu</span><span class=\"token punctuation\">(</span>MF_STRING<span class=\"token punctuation\">,</span> IDM_ABOUTBOX<span class=\"token punctuation\">,</span> strAboutMenu<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token comment\">// 设置此对话框的图标。当应用程序主窗口不是对话框时，框架将自动</span>\n\t<span class=\"token comment\">//  执行此操作</span>\n\t<span class=\"token function\">SetIcon</span><span class=\"token punctuation\">(</span>m_hIcon<span class=\"token punctuation\">,</span> TRUE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t\t\t<span class=\"token comment\">// 设置大图标</span>\n\t<span class=\"token function\">SetIcon</span><span class=\"token punctuation\">(</span>m_hIcon<span class=\"token punctuation\">,</span> FALSE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">// 设置小图标</span>\n\t<span class=\"token comment\">// TODO: 在此添加额外的初始化代码</span>\n\tm_myProtocol<span class=\"token punctuation\">.</span><span class=\"token function\">SetParent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">return</span> TRUE<span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 除非将焦点设置到控件，否则返回 TRUE</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> CSlidingWindowDlg<span class=\"token operator\">::</span><span class=\"token function\">OnSysCommand</span><span class=\"token punctuation\">(</span>UINT nID<span class=\"token punctuation\">,</span> LPARAM lParam<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>nID<span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFFF0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> IDM_ABOUTBOX<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tCAboutDlgdlgAbout<span class=\"token punctuation\">;</span>\n\t\tdlgAbout<span class=\"token punctuation\">.</span><span class=\"token function\">DoModal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">else</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tCDialog<span class=\"token operator\">::</span><span class=\"token function\">OnSysCommand</span><span class=\"token punctuation\">(</span>nID<span class=\"token punctuation\">,</span> lParam<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 如果向对话框添加最小化按钮，则需要下面的代码</span>\n<span class=\"token comment\">//  来绘制该图标。对于使用文档/视图模型的 MFC 应用程序，</span>\n<span class=\"token comment\">//  这将由框架自动完成。</span>\n\n<span class=\"token keyword\">void</span> CSlidingWindowDlg<span class=\"token operator\">::</span><span class=\"token function\">OnPaint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">IsIconic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tCPaintDC <span class=\"token function\">dc</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 用于绘制的设备上下文</span>\n\t\t<span class=\"token function\">SendMessage</span><span class=\"token punctuation\">(</span>WM_ICONERASEBKGND<span class=\"token punctuation\">,</span> <span class=\"token keyword\">reinterpret_cast</span><span class=\"token operator\">&lt;</span>WPARAM<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>dc<span class=\"token punctuation\">.</span><span class=\"token function\">GetSafeHdc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">// 使图标在工作区矩形中居中</span>\n\t\tintcxIcon <span class=\"token operator\">=</span> <span class=\"token function\">GetSystemMetrics</span><span class=\"token punctuation\">(</span>SM_CXICON<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tintcyIcon <span class=\"token operator\">=</span> <span class=\"token function\">GetSystemMetrics</span><span class=\"token punctuation\">(</span>SM_CYICON<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tCRectrect<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">GetClientRect</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>rect<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">int</span> x <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>rect<span class=\"token punctuation\">.</span><span class=\"token function\">Width</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> cxIcon <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">int</span> y <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>rect<span class=\"token punctuation\">.</span><span class=\"token function\">Height</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> cyIcon <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">// 绘制图标</span>\n\t\tdc<span class=\"token punctuation\">.</span><span class=\"token function\">DrawIcon</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> m_hIcon<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">else</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tCDialog<span class=\"token operator\">::</span><span class=\"token function\">OnPaint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">//当用户拖动最小化窗口时系统调用此函数取得光标</span>\n<span class=\"token comment\">//显示。</span>\nHCURSOR CSlidingWindowDlg<span class=\"token operator\">::</span><span class=\"token function\">OnQueryDragIcon</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">static_cast</span><span class=\"token operator\">&lt;</span>HCURSOR<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>m_hIcon<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token keyword\">void</span> CSlidingWindowDlg<span class=\"token operator\">::</span><span class=\"token function\">OnBnClickedButtonSavePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// TODO: 在此添加控件通知处理程序代码</span>\n\t<span class=\"token function\">UpdateData</span><span class=\"token punctuation\">(</span>TRUE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tPIDLIST_ABSOLUTE   pIDL<span class=\"token punctuation\">;</span> \n\tTCHAR szPath<span class=\"token punctuation\">[</span>_MAX_PATH<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\tBROWSEINFO bo<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">ZeroMemory</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>bo<span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>bo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tbo<span class=\"token punctuation\">.</span>hwndOwner <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token operator\">-></span>m_hWnd<span class=\"token punctuation\">;</span>\n\tbo<span class=\"token punctuation\">.</span>ulFlags <span class=\"token operator\">=</span> BIF_USENEWUI<span class=\"token operator\">|</span>BIF_RETURNFSANCESTORS<span class=\"token operator\">|</span>BIF_RETURNONLYFSDIRS<span class=\"token punctuation\">;</span>\n\tbo<span class=\"token punctuation\">.</span>lpszTitle <span class=\"token operator\">=</span> <span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"请选择保存目录\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tpIDL <span class=\"token operator\">=</span> <span class=\"token function\">SHBrowseForFolder</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>bo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">SHGetPathFromIDList</span><span class=\"token punctuation\">(</span>pIDL<span class=\"token punctuation\">,</span>szPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tm_szSavePath<span class=\"token punctuation\">.</span><span class=\"token function\">Format</span><span class=\"token punctuation\">(</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>szPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>m_szSavePath<span class=\"token punctuation\">.</span><span class=\"token function\">GetLength</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>m_szSavePath<span class=\"token punctuation\">.</span><span class=\"token function\">GetAt</span><span class=\"token punctuation\">(</span>m_szSavePath<span class=\"token punctuation\">.</span><span class=\"token function\">GetLength</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\\\'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\tm_szSavePath<span class=\"token punctuation\">.</span><span class=\"token function\">AppendChar</span><span class=\"token punctuation\">(</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\\\'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token function\">GetDlgItem</span><span class=\"token punctuation\">(</span>IDC_BUTTON_LISTEN<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">EnableWindow</span><span class=\"token punctuation\">(</span>TRUE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">CoTaskMemFree</span><span class=\"token punctuation\">(</span>pIDL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">UpdateData</span><span class=\"token punctuation\">(</span>FALSE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> CSlidingWindowDlg<span class=\"token operator\">::</span><span class=\"token function\">OnBnClickedButtonSendFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// TODO: 在此添加控件通知处理程序代码</span>\n\tCFileDialog <span class=\"token function\">fd</span><span class=\"token punctuation\">(</span>TRUE<span class=\"token punctuation\">,</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*.*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span>OFN_FILEMUSTEXIST<span class=\"token operator\">|</span>OFN_HIDEREADONLY<span class=\"token punctuation\">,</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"All Files (*.*)|*.*||\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tfd<span class=\"token punctuation\">.</span>m_ofn<span class=\"token punctuation\">.</span>lStructSize <span class=\"token operator\">=</span> <span class=\"token number\">88</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">.</span><span class=\"token function\">DoModal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> IDOK<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">UpdateData</span><span class=\"token punctuation\">(</span>TRUE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tm_szSendFile <span class=\"token operator\">=</span> fd<span class=\"token punctuation\">.</span><span class=\"token function\">GetPathName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">UpdateData</span><span class=\"token punctuation\">(</span>FALSE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">GetDlgItem</span><span class=\"token punctuation\">(</span>IDC_BUTTON_SEND<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">EnableWindow</span><span class=\"token punctuation\">(</span>TRUE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> CSlidingWindowDlg<span class=\"token operator\">::</span><span class=\"token function\">OnBnClickedButtonListen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// TODO: 在此添加控件通知处理程序代码</span>\n\t<span class=\"token function\">UpdateData</span><span class=\"token punctuation\">(</span>TRUE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tCString tem<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">GetDlgItem</span><span class=\"token punctuation\">(</span>IDC_BUTTON_LISTEN<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">GetWindowText</span><span class=\"token punctuation\">(</span>tem<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tem <span class=\"token operator\">==</span> <span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"监听\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>m_myProtocol<span class=\"token punctuation\">.</span><span class=\"token function\">Create</span><span class=\"token punctuation\">(</span>m_nLocalPort<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> FALSE<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\tm_listSend<span class=\"token punctuation\">.</span><span class=\"token function\">AddString</span><span class=\"token punctuation\">(</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"错误:无法开启!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\tm_myProtocol<span class=\"token punctuation\">.</span><span class=\"token function\">Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">GetDlgItem</span><span class=\"token punctuation\">(</span>IDC_BUTTON_LISTEN<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">SetWindowText</span><span class=\"token punctuation\">(</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"停止\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">GetDlgItem</span><span class=\"token punctuation\">(</span>IDC_OWN_PORT<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">EnableWindow</span><span class=\"token punctuation\">(</span>FALSE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">else</span>\n\t<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">GetDlgItem</span><span class=\"token punctuation\">(</span>IDC_BUTTON_LISTEN<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">SetWindowText</span><span class=\"token punctuation\">(</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"监听\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">GetDlgItem</span><span class=\"token punctuation\">(</span>IDC_OWN_PORT<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">EnableWindow</span><span class=\"token punctuation\">(</span>TRUE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tm_myProtocol<span class=\"token punctuation\">.</span><span class=\"token function\">Stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">UpdateData</span><span class=\"token punctuation\">(</span>FALSE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> CSlidingWindowDlg<span class=\"token operator\">::</span><span class=\"token function\">OnTimer</span><span class=\"token punctuation\">(</span>UINT_PTR nIDEvent<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// TODO: 在此添加消息处理程序代码和/或调用默认值</span>\n\tm_myProtocol<span class=\"token punctuation\">.</span><span class=\"token function\">Timeout</span><span class=\"token punctuation\">(</span>nIDEvent <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> CSlidingWindowDlg<span class=\"token operator\">::</span><span class=\"token function\">OnReceive</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span> buf <span class=\"token punctuation\">,</span> UINT nBytes<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nBytes <span class=\"token operator\">==</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>HEADE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tHEADE <span class=\"token operator\">*</span> pHeader<span class=\"token punctuation\">;</span>\n\t\tpHeader <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>HEADE <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>buf<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">memcmp</span><span class=\"token punctuation\">(</span>pHeader<span class=\"token operator\">-></span>szIdentify<span class=\"token punctuation\">,</span><span class=\"token string\">\"@HEADZGF\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\tm_fileSave<span class=\"token punctuation\">.</span><span class=\"token function\">Open</span><span class=\"token punctuation\">(</span>m_szSavePath <span class=\"token operator\">+</span> pHeader<span class=\"token operator\">-></span>szName<span class=\"token punctuation\">,</span>CFile<span class=\"token operator\">::</span>modeCreate<span class=\"token operator\">|</span>CFile<span class=\"token operator\">::</span>modeWrite<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\tm_nRecvFileSize <span class=\"token operator\">=</span> pHeader<span class=\"token operator\">-></span>nLength<span class=\"token punctuation\">;</span>\n\t\t\tm_nRecvNow <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\t\tm_listReceive<span class=\"token punctuation\">.</span><span class=\"token function\">AddString</span><span class=\"token punctuation\">(</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"开始接收文件...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\tm_listReceive<span class=\"token punctuation\">.</span><span class=\"token function\">AddString</span><span class=\"token punctuation\">(</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"文件名:\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token function\">CString</span><span class=\"token punctuation\">(</span>pHeader<span class=\"token operator\">-></span>szName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n\n\tm_fileSave<span class=\"token punctuation\">.</span><span class=\"token function\">Write</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">,</span>nBytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tm_nRecvNow <span class=\"token operator\">+=</span> nBytes<span class=\"token punctuation\">;</span>\n\tm_proReceive<span class=\"token punctuation\">.</span><span class=\"token function\">SetPos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>m_nRecvNow<span class=\"token operator\">/</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">double</span><span class=\"token punctuation\">)</span>m_nRecvFileSize<span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>m_nRecvNow <span class=\"token operator\">==</span> m_nRecvFileSize<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tm_fileSave<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tm_proReceive<span class=\"token punctuation\">.</span><span class=\"token function\">SetPos</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tm_listReceive<span class=\"token punctuation\">.</span><span class=\"token function\">AddString</span><span class=\"token punctuation\">(</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"接收完成!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tm_proReceive<span class=\"token punctuation\">.</span><span class=\"token function\">SetPos</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> CSlidingWindowDlg<span class=\"token operator\">::</span><span class=\"token function\">OnBnClickedButtonSend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// TODO: 在此添加控件通知处理程序代码</span>\n\t<span class=\"token function\">UpdateData</span><span class=\"token punctuation\">(</span>TRUE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>m_myProtocol<span class=\"token punctuation\">.</span><span class=\"token function\">SetDestination</span><span class=\"token punctuation\">(</span>m_szDestination<span class=\"token punctuation\">,</span>m_nDestPort<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> FALSE<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tm_listSend<span class=\"token punctuation\">.</span><span class=\"token function\">AddString</span><span class=\"token punctuation\">(</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"错误:找不到目标主机\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>m_myProtocol<span class=\"token punctuation\">.</span><span class=\"token function\">Create</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> FALSE<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tm_listSend<span class=\"token punctuation\">.</span><span class=\"token function\">AddString</span><span class=\"token punctuation\">(</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"错误:无法创建套接字\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\tm_myProtocol<span class=\"token punctuation\">.</span><span class=\"token function\">Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">AfxBeginThread</span><span class=\"token punctuation\">(</span>SendThread<span class=\"token punctuation\">,</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nUINT CSlidingWindowDlg<span class=\"token operator\">::</span><span class=\"token function\">SendThread</span><span class=\"token punctuation\">(</span>LPVOID p<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n\tCSlidingWindowDlg <span class=\"token operator\">*</span>my <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>CSlidingWindowDlg <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>p<span class=\"token punctuation\">;</span>\n\tCFile file<span class=\"token punctuation\">;</span>\n\tCString name<span class=\"token punctuation\">;</span>\n\tBYTE buf<span class=\"token punctuation\">[</span>MAX_PKT<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\tHEADE header<span class=\"token punctuation\">;</span>\n\tUINT nRead<span class=\"token punctuation\">;</span>\n\tULONGLONG nTotal<span class=\"token punctuation\">;</span>\n\tULONGLONG nNow <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">Open</span><span class=\"token punctuation\">(</span>my<span class=\"token operator\">-></span>m_szSendFile<span class=\"token punctuation\">,</span>CFile<span class=\"token operator\">::</span>modeRead<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> FALSE<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tmy<span class=\"token operator\">-></span>m_listSend<span class=\"token punctuation\">.</span><span class=\"token function\">AddString</span><span class=\"token punctuation\">(</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"错误:无法打开文件\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">(</span>my<span class=\"token operator\">-></span><span class=\"token function\">GetDlgItem</span><span class=\"token punctuation\">(</span>IDC_BUTTON_SEND<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">EnableWindow</span><span class=\"token punctuation\">(</span>FALSE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tmy<span class=\"token operator\">-></span>m_listSend<span class=\"token punctuation\">.</span><span class=\"token function\">AddString</span><span class=\"token punctuation\">(</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"开始发送!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\tname <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span><span class=\"token function\">GetFileName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>header<span class=\"token punctuation\">.</span>szIdentify<span class=\"token punctuation\">,</span><span class=\"token string\">\"@HEADZGF\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">lstrcpy</span><span class=\"token punctuation\">(</span>header<span class=\"token punctuation\">.</span>szName<span class=\"token punctuation\">,</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\theader<span class=\"token punctuation\">.</span>nLength <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span><span class=\"token function\">GetLength</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tnTotal <span class=\"token operator\">=</span> header<span class=\"token punctuation\">.</span>nLength<span class=\"token punctuation\">;</span>\n\tmy<span class=\"token operator\">-></span>m_myProtocol<span class=\"token punctuation\">.</span><span class=\"token function\">SendPacket</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>header<span class=\"token punctuation\">,</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>HEADE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>nNow<span class=\"token operator\">&lt;</span>nTotal<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tnRead <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span><span class=\"token function\">Read</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">,</span>MAX_PKT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tmy<span class=\"token operator\">-></span>m_myProtocol<span class=\"token punctuation\">.</span><span class=\"token function\">SendPacket</span><span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">,</span>nRead<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tnNow <span class=\"token operator\">+=</span> nRead<span class=\"token punctuation\">;</span>\n\t\tmy<span class=\"token operator\">-></span>m_proSend<span class=\"token punctuation\">.</span><span class=\"token function\">SetPos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>nNow<span class=\"token operator\">/</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">double</span><span class=\"token punctuation\">)</span>nTotal<span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\tmy<span class=\"token operator\">-></span>m_proSend<span class=\"token punctuation\">.</span><span class=\"token function\">SetPos</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tmy<span class=\"token operator\">-></span>m_listSend<span class=\"token punctuation\">.</span><span class=\"token function\">AddString</span><span class=\"token punctuation\">(</span><span class=\"token function\">_T</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"发送完成!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">(</span>my<span class=\"token operator\">-></span><span class=\"token function\">GetDlgItem</span><span class=\"token punctuation\">(</span>IDC_BUTTON_SEND<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">EnableWindow</span><span class=\"token punctuation\">(</span>TRUE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tmy<span class=\"token operator\">-></span>m_proSend<span class=\"token punctuation\">.</span><span class=\"token function\">SetPos</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol>\n<li>开启一个客户端（作为实验的接收端），并确立监听端口与目标端口：\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 466px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/257ca71a53734d3a99c73aae1caa26c5/1b529/1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 89.1891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAASABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB69tCZLFSEA//xAAaEAACAgMAAAAAAAAAAAAAAAAAARAxERIh/9oACAEBAAEFAuGEaoVIdz//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAWEAADAAAAAAAAAAAAAAAAAAAQIDH/2gAIAQEABj8CEf8A/8QAGRABAAMBAQAAAAAAAAAAAAAAAQARMSEQ/9oACAEBAAE/IQs8gmHJbpgKQ2TSC17/AP/aAAwDAQACAAMAAAAQrwgA/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAEREP/aAAgBAwEBPxCIr3//xAAWEQADAAAAAAAAAAAAAAAAAAABESD/2gAIAQIBAT8QZj//xAAaEAEAAwEBAQAAAAAAAAAAAAABABExIVFB/9oACAEBAAE/EDFV75sYsPjItVr6kzGkBFLb2KgMgB1z2ChxSPW2f//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/257ca71a53734d3a99c73aae1caa26c5/1b529/1.jpg\"\n        srcset=\"/static/257ca71a53734d3a99c73aae1caa26c5/a80bd/1.jpg 148w,\n/static/257ca71a53734d3a99c73aae1caa26c5/1c91a/1.jpg 295w,\n/static/257ca71a53734d3a99c73aae1caa26c5/1b529/1.jpg 466w\"\n        sizes=\"(max-width: 466px) 100vw, 466px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n<li>开启一个客户端（作为实验的发送端），并确立监听端口与目标端口：\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 468px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/001c5b9165e6a7cd8984ed73d15f77ac/7883a/2.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.54054054054053%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAASABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB69tCZLFSEA//xAAZEAEBAQADAAAAAAAAAAAAAAABADEQERL/2gAIAQEAAQUCC6vJGE6Zx//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABgQAAIDAAAAAAAAAAAAAAAAAAAxASAh/9oACAEBAAY/AkI2L//EABsQAAICAwEAAAAAAAAAAAAAAAABETEQIUFx/9oACAEBAAE/IUcQtSCWkVR8FlFg2mf/2gAMAwEAAgADAAAAEI/YPP/EABcRAAMBAAAAAAAAAAAAAAAAAAABERD/2gAIAQMBAT8QiK9//8QAFhEAAwAAAAAAAAAAAAAAAAAAAREg/9oACAECAQE/EGY//8QAGhABAAMBAQEAAAAAAAAAAAAAAQARMSFBYf/aAAgBAQABPxC6iM+eQPUV1Ut6nkzOiAilt7EgDyIdHD2ChxSPW2f/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2\"\n        title=\"2\"\n        src=\"/static/001c5b9165e6a7cd8984ed73d15f77ac/7883a/2.jpg\"\n        srcset=\"/static/001c5b9165e6a7cd8984ed73d15f77ac/a80bd/2.jpg 148w,\n/static/001c5b9165e6a7cd8984ed73d15f77ac/1c91a/2.jpg 295w,\n/static/001c5b9165e6a7cd8984ed73d15f77ac/7883a/2.jpg 468w\"\n        sizes=\"(max-width: 468px) 100vw, 468px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n<li>发送文件：\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 471px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/65a5afe09ff56fac0051c5157a42c003/91c37/3.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 89.1891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAASABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAECAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB9fW6nNSqEB//xAAbEAACAQUAAAAAAAAAAAAAAAAAATECEBESIf/aAAgBAQABBQJGDVFK4hyot//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABcQAAMBAAAAAAAAAAAAAAAAAAEQICH/2gAIAQEABj8CWiA//8QAHBAAAgICAwAAAAAAAAAAAAAAAAEQMREhQWGR/9oACAEBAAE/IVXCLUjJQxWPaF1A/lP/2gAMAwEAAgADAAAAEEzQPP/EABcRAAMBAAAAAAAAAAAAAAAAAAABERD/2gAIAQMBAT8QiK9//8QAFhEAAwAAAAAAAAAAAAAAAAAAAREg/9oACAECAQE/EGY//8QAGxABAAMBAQEBAAAAAAAAAAAAAQARITFBcbH/2gAIAQEAAT8QrALh3PIdMvstqtfU8hntaGnhkBSlt1caIGiJ0ePyChjUdbZ//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3\"\n        title=\"3\"\n        src=\"/static/65a5afe09ff56fac0051c5157a42c003/91c37/3.jpg\"\n        srcset=\"/static/65a5afe09ff56fac0051c5157a42c003/a80bd/3.jpg 148w,\n/static/65a5afe09ff56fac0051c5157a42c003/1c91a/3.jpg 295w,\n/static/65a5afe09ff56fac0051c5157a42c003/91c37/3.jpg 471w\"\n        sizes=\"(max-width: 471px) 100vw, 471px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n<li>接收文件：\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 474px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d0acd9ca695e5917eb43e2029a8a562e/08ff2/4.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAASABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAezreSAsAD//xAAVEAEBAAAAAAAAAAAAAAAAAAABIP/aAAgBAQABBQIgJ//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABUQAQEAAAAAAAAAAAAAAAAAACAR/9oACAEBAAY/AhT/AP/EABsQAAMAAgMAAAAAAAAAAAAAAAABERAhQVFx/9oACAEBAAE/IdKJ3zEUO4zllFj/2gAMAwEAAgADAAAAEAAHPP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8QH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8QH//EABsQAQACAwEBAAAAAAAAAAAAAAEAIRExUUFh/9oACAEBAAE/EGIB6lFsew/FQu0uBVPIKCyOzNR1cZl1iQAcE7P/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"4\"\n        title=\"4\"\n        src=\"/static/d0acd9ca695e5917eb43e2029a8a562e/08ff2/4.jpg\"\n        srcset=\"/static/d0acd9ca695e5917eb43e2029a8a562e/a80bd/4.jpg 148w,\n/static/d0acd9ca695e5917eb43e2029a8a562e/1c91a/4.jpg 295w,\n/static/d0acd9ca695e5917eb43e2029a8a562e/08ff2/4.jpg 474w\"\n        sizes=\"(max-width: 474px) 100vw, 474px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n</ol>\n<h2></h2>\n<ul>\n<li>采用滑动窗口中的选择重发协议实现了一个文件传输程序。</li>\n<li>由于UDP协议与数据链路层有一个重要不同就是先发不一定先到，所以若用UDP模拟链路层滑动窗口协议，较理想的就是选择重发协议（我也实现了返回n，实际测试速度远不如选择重发）而且序号应很大，否则可能出错。由于实际文件传输基本不会双向同时传输，故我取消了捎带回复机制，选择单独发送ACK，以加快速度。</li>\n<li>程序的使用方法就是，打开两个客户端，一个发送一个接收。收端先选择保存路径然后点监听，发送端选择文件然后点发送。</li>\n</ul>","frontmatter":{"title":"滑动窗口协议","date":"March 01, 2014","description":"采用滑动窗口中的选择重发协议实现了一个文件传输程序。","tags":["C/C++","TCP/IP"]}}},"pageContext":{"slug":"/blogs/Sliding-Window-Protocol/","previous":{"fields":{"slug":"/blogs/A-star-algorithm/"},"frontmatter":{"title":"使用C++实现A*寻路算法"}},"next":{"fields":{"slug":"/blogs/Routing-Information-Protocol/"},"frontmatter":{"title":"路由协议RIP的简单实现"}}}}}